const CACHE_NAME="notes-app-v1",urlsToCache=["/","/index.html","/manifest.json","/images/logo.png"],IMAGE_CACHE_NAME="story-image-cache";import{BASE_URL}from"../scripts/config";self.addEventListener("install",(e=>{e.waitUntil(caches.open(CACHE_NAME).then((e=>(console.log("Opened cache"),e.addAll(urlsToCache)))))})),self.addEventListener("activate",(e=>{e.waitUntil(caches.keys().then((e=>{Promise.all(e.filter((e=>e!==CACHE_NAME&&e!==IMAGE_CACHE_NAME)).map((e=>(console.log("Deleting old cache:",e),caches.delete(e)))))})))})),self.addEventListener("fetch",(e=>{const t=new URL(e.request.url);t.origin===BASE_URL&&t.pathname.startsWith("/images/stories")?e.respondWith(caches.open(IMAGE_CACHE_NAME).then((t=>{t.match(e.request).then((a=>a||fetch(e.request).then((a=>(t.put(e.request,a.clone()),a))).catch((()=>caches.match("/images/logo.png")))))}))):e.respondWith(caches.match(e.request).then((t=>t||fetch(e.request))))})),self.addEventListener("push",(e=>{let t="New Notification",a={body:"You have a new notification.",icon:"/images/logo.png",badge:"/images/logo.png"};if(e.data)try{const o=e.data.json();t=o.title||t,a.body=o.body||a.body,a.icon=o.icon||a.icon,a.badge=o.badge||a.badge}catch(o){const i=e.data.text();return a.body=i,void e.waitUntil(self.registration.showNotification(t,a))}e.waitUntil(self.registration.showNotification(t,a))})),self.addEventListener("message",(e=>{if(console.log("service worker received message:",e.data),e.data&&"SHOW_MAP_NOTIFICATION"===e.data.type){const{title:t,body:a,icon:o,badge:i}=e.data;self.registration.showNotification(t,{body:a,icon:o,badge:i})}}));